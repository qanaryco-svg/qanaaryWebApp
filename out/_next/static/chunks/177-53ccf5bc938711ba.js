"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{3064:function(e,t,l){l.d(t,{Z:function(){return AdminProductForm}});var a=l(5893),s=l(7294),n=l(3293),r=l(3488),i=l(2929);function AdminProductForm(e){var t;let{product:l,onCancel:o,onSave:d}=e,[c,m]=(0,s.useState)((null==l?void 0:l.title)||""),[u,p]=(0,s.useState)((null==l?void 0:l.price)||0),[x,g]=(0,s.useState)(null!==(t=null==l?void 0:l.discount)&&void 0!==t?t:0),[h,f]=(0,s.useState)((null==l?void 0:l.images.join(","))||""),[v,b]=(0,s.useState)((null==l?void 0:l.description)||""),[j,N]=(0,s.useState)((null==l?void 0:l.category)||""),[y,C]=(0,s.useState)(l&&l.style&&l.style.tags?l.style.tags.join(","):""),[S,w]=(0,s.useState)([]),[U,A]=(0,s.useState)([]),[I,k]=(0,s.useState)({}),[F,B]=(0,s.useState)(!1),[E,_]=(0,s.useState)([]);(0,s.useEffect)(()=>{var e;m((null==l?void 0:l.title)||""),p((null==l?void 0:l.price)||0),g(null!==(e=null==l?void 0:l.discount)&&void 0!==e?e:0),f((null==l?void 0:l.images)?l.images.join(","):""),b((null==l?void 0:l.description)||""),N((null==l?void 0:l.category)||""),C(l&&l.style&&l.style.tags?l.style.tags.join(","):"")},[l]);let genId=()=>"p_"+Date.now().toString(36),[D]=(0,s.useState)("temp_"+Math.random().toString(36).slice(2,8)),W=l&&l.id?l.id:D;(0,s.useEffect)(()=>{let e=h.split(",").map(e=>e.trim()).filter(Boolean);A(e),validate(!1)},[h,c,u]),(0,s.useEffect)(()=>{try{_((0,r.IT)(W))}catch(e){_([])}try{let e=(0,i.QD)();w(Array.from(new Set(e.map(e=>e.category).filter(Boolean))))}catch(e){w([])}},[W]);let insertUpload=e=>{let t=h.split(",").map(e=>e.trim()).filter(Boolean);t.push(e.dataUrl),f(t.join(","))},handleFileInput=e=>{e&&Array.from(e).forEach(e=>{let t=new FileReader;t.onload=()=>{let l=String(t.result||""),a=e.type.startsWith("image")?"image":"video",s={id:"u_"+Date.now().toString(36)+Math.random().toString(36).slice(2,6),type:a,name:e.name,dataUrl:l,createdAt:Date.now(),galleryId:W};try{(0,r.wW)(s),_((0,r.IT)(W)),insertUpload(s)}catch(e){}},t.readAsDataURL(e)})},q=h.split(",").map(e=>e.trim()).filter(Boolean),removeImageAt=e=>{let t=[...q];t.splice(e,1),f(t.join(","))},setAsMain=e=>{let t=[...q],[l]=t.splice(e,1);t.unshift(l),f(t.join(","))},moveImage=(e,t)=>{let l=[...q],a=e+t;if(a<0||a>=l.length)return;let s=l[a];l[a]=l[e],l[e]=s,f(l.join(","))},validate=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t={};c&&0!==c.trim().length||(t.title="عنوان نمی‌تواند خالی باشد."),(isNaN(Number(u))||0>Number(u))&&(t.price="قیمت باید عدد و صفر یا بیشتر باشد."),(isNaN(Number(x))||0>Number(x)||Number(x)>99)&&(t.discount="تخفیف باید بین 0 تا 99 باشد."),e&&k(t);let l=0===Object.keys(t).length;return B(l),l},{t:L}=(0,n.Z)();return(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!validate())return;let t=l&&l.id?l.id:genId(),a=h.split(",").map(e=>e.trim()).filter(Boolean);0===a.length&&f((a=["/p1.svg"]).join(","));let s={id:t,title:c.trim(),price:Number(u),images:a,description:v,category:j,discount:Number(x)},n=y.split(",").map(e=>e.trim()).filter(Boolean);n.length>0&&(s.style={tags:n});try{D&&D.startsWith("temp_")&&t&&(!l||!l.id)&&(0,r.TX)(D,t)}catch(e){}d(s)},className:"max-w-lg p-4 border rounded",children:[(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block text-sm",children:L("titleLabel")}),(0,a.jsx)("input",{value:c,onChange:e=>m(e.target.value),className:"w-full px-2 py-1 border rounded"})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block text-sm",children:L("priceLabel")}),(0,a.jsx)("input",{value:u,onChange:e=>p(Number(e.target.value)),className:"w-full px-2 py-1 border rounded",type:"number"})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block text-sm",children:"درصد تخفیف"}),(0,a.jsx)("input",{value:x,onChange:e=>g(Number(e.target.value)),className:"w-full px-2 py-1 border rounded",type:"number",min:"0",max:"99"}),I.discount&&(0,a.jsx)("div",{className:"text-sm text-red-600 mt-1",children:I.discount})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block text-sm",children:L("imagesLabel")}),(0,a.jsx)("input",{value:h,onChange:e=>f(e.target.value),className:"w-full px-2 py-1 border rounded"}),I.images&&(0,a.jsx)("div",{className:"text-sm text-red-600 mt-1",children:I.images}),U.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[L("preview"),":"]}),(0,a.jsx)("div",{className:"mt-2 flex gap-2 items-center",children:q.map((e,t)=>(0,a.jsxs)("div",{className:"border p-1 text-center",children:[e.startsWith("data:video")||e.endsWith(".mp4")||e.startsWith("blob:")?(0,a.jsx)("video",{src:e,className:"h-20 w-20 object-cover"}):(0,a.jsx)("img",{src:e,alt:"preview-".concat(t),className:"h-20 w-20 object-contain"}),(0,a.jsxs)("div",{className:"mt-1 flex gap-1 justify-center",children:[(0,a.jsx)("button",{type:"button",onClick:()=>removeImageAt(t),className:"px-2 py-1 text-xs border rounded text-red-600",children:"حذف"}),(0,a.jsx)("button",{type:"button",onClick:()=>setAsMain(t),className:"px-2 py-1 text-xs border rounded",children:"تنظیم به عنوان اصلی"}),(0,a.jsx)("button",{type:"button",onClick:()=>moveImage(t,-1),className:"px-2 py-1 text-xs border rounded",children:"←"}),(0,a.jsx)("button",{type:"button",onClick:()=>moveImage(t,1),className:"px-2 py-1 text-xs border rounded",children:"→"})]})]},t))})]}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"آپلود جدید (تصویر/ویدیو)"}),(0,a.jsx)("input",{type:"file",accept:"image/*,image/jpeg,image/jpg,video/*",multiple:!0,onChange:e=>handleFileInput(e.target.files)})]}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("div",{className:"text-sm font-semibold mb-2",children:L("uploadedFilesTitle")}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[E.map(e=>(0,a.jsxs)("div",{className:"border p-1 text-center",children:["image"===e.type?(0,a.jsx)("img",{src:e.dataUrl,className:"h-20 w-full object-cover"}):(0,a.jsx)("video",{src:e.dataUrl,className:"h-20 w-full"}),(0,a.jsx)("div",{className:"mt-1 flex gap-1 justify-center",children:(0,a.jsx)("button",{type:"button",onClick:()=>insertUpload(e),className:"px-2 py-1 text-xs border rounded",children:"اضافه"})})]},e.id)),0===E.length&&(0,a.jsx)("div",{className:"text-gray-500",children:L("noFilesMsg")})]})]})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block text-sm",children:L("categoryLabel")}),(0,a.jsx)("input",{list:"category-suggestions",value:j,onChange:e=>N(e.target.value),className:"w-full px-2 py-1 border rounded"}),(0,a.jsx)("datalist",{id:"category-suggestions",children:S.map(e=>(0,a.jsx)("option",{value:e},e))})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block text-sm",children:"ویژگی‌های استایل (تگ‌ها، با کاما جداکن)"}),(0,a.jsx)("input",{value:y,onChange:e=>C(e.target.value),placeholder:"مثال: casual, summer, fitted",className:"w-full px-2 py-1 border rounded"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"این تگ‌ها به Style Finder کمک می‌کنند تا محصولات را بهتر دسته‌بندی کند."})]}),(0,a.jsxs)("div",{className:"mb-2",children:[I.title&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:I.title}),I.price&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:I.price})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block text-sm",children:L("descriptionLabel")}),(0,a.jsx)("textarea",{value:v,onChange:e=>b(e.target.value),className:"w-full px-2 py-1 border rounded"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-qanari text-qanariDark rounded",type:"submit",disabled:!F,children:L("save")}),(0,a.jsx)("button",{type:"button",className:"px-4 py-2 border rounded",onClick:o,children:L("cancel")})]})]})}},2095:function(e,t,l){l.r(t),l.d(t,{addComment:function(){return addComment},deleteComment:function(){return deleteComment},deleteCommentsForProduct:function(){return deleteCommentsForProduct},getCommentsFor:function(){return getCommentsFor},getStats:function(){return getStats},loadAllComments:function(){return loadAllComments},persistAllComments:function(){return persistAllComments}});let a="qanari:comments";function loadAllComments(){try{let e=localStorage.getItem(a);return e?JSON.parse(e):[]}catch(e){return[]}}function getCommentsFor(e){return loadAllComments().filter(t=>t.productId===e)}function getStats(e){let t=getCommentsFor(e),l=t.length;if(0===l)return{avg:0,count:0};let a=t.reduce((e,t)=>e+(t.rating||0),0);return{avg:a/l,count:l}}function persistAllComments(e){try{localStorage.setItem(a,JSON.stringify(e));try{window.dispatchEvent(new CustomEvent("qanari:comments-updated"))}catch(e){}try{if("undefined"!=typeof BroadcastChannel){let e=new BroadcastChannel("qanari:comments");e.postMessage({type:"updated"}),e.close()}}catch(e){}}catch(e){}}function addComment(e){let t=loadAllComments(),l=[e,...t];persistAllComments(l)}function deleteComment(e){let t=loadAllComments(),l=t.filter(t=>t.id!==e);persistAllComments(l)}function deleteCommentsForProduct(e){let t=loadAllComments(),l=t.filter(t=>t.productId!==e);persistAllComments(l)}},3488:function(e,t,l){l.d(t,{HZ:function(){return deleteUpload},IT:function(){return loadUploads},TX:function(){return transferUploads},gI:function(){return updateUpload},wW:function(){return addUpload}});let a="qanari:uploads";function loadUploads(e){try{let t=localStorage.getItem(a),l=t?JSON.parse(t):[];if(void 0===e)return l;return l.filter(t=>t.galleryId===e)}catch(e){return[]}}function saveUploads(e){try{localStorage.setItem(a,JSON.stringify(e))}catch(e){}}function addUpload(e){let t=loadUploads();t.unshift(e),saveUploads(t)}function deleteUpload(e){let t=loadUploads().filter(t=>t.id!==e);saveUploads(t)}function updateUpload(e){try{let t=loadUploads(),l=t.findIndex(t=>t.id===e.id);if(-1===l)return!1;let a=t[l];return t[l]={...a,...e},saveUploads(t),!0}catch(e){return!1}}function transferUploads(e,t){try{let l=loadUploads(),a=!1;for(let s of l)s.galleryId===e&&(s.galleryId=t,a=!0);a&&saveUploads(l)}catch(e){}}}}]);