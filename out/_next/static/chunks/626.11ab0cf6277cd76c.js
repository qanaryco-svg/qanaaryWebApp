"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{1443:function(e,t,r){r.r(t),r.d(t,{default:function(){return Chatbot}});var a=r(5893),s=r(7294);function Chatbot(){let[e,t]=(0,s.useState)(!1),[r,l]=(0,s.useState)(()=>{try{let e=sessionStorage.getItem("qanari:chat");return e?JSON.parse(e):[{role:"system",content:"شما با دستیار قناری صحبت می‌کنید. می‌توانم درباره محصولات، سفارش و پرداخت کمک کنم."}]}catch(e){return[{role:"system",content:"شما با دستیار قناری صحبت می‌کنید. می‌توانم درباره محصولات، سفارش و پرداخت کمک کنم."}]}}),[n,o]=(0,s.useState)(""),[d,c]=(0,s.useState)(!1),i=(0,s.useRef)(null),u=(0,s.useRef)(null);async function send(){if(!n.trim())return;let e=[...r,{role:"user",content:n}];l(e),o(""),c(!0);try{let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e})}),r=await t.json(),a=(null==r?void 0:r.text)||(null==r?void 0:r.fallback)||"متأسفانه پاسخی دریافت نشد.";l(e=>[...e,{role:"assistant",content:String(a)}])}catch(e){l(e=>[...e,{role:"assistant",content:"خطا در ارسال پیام. دوباره تلاش کنید."}])}finally{c(!1)}}return(0,s.useEffect)(()=>{try{sessionStorage.setItem("qanari:chat",JSON.stringify(r))}catch(e){}try{i.current&&(i.current.scrollTop=i.current.scrollHeight)}catch(e){}},[r]),(0,s.useEffect)(()=>{e&&setTimeout(()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.focus()},50)},[e]),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"fixed bottom-6 left-6 z-50",children:(0,a.jsx)("button",{"aria-label":"open-chat",onClick:()=>t(e=>!e),className:"bg-blue-600 text-white rounded-full w-14 h-14 shadow-lg flex items-center justify-center",children:e?"\xd7":"چت"})}),e&&(0,a.jsxs)("div",{className:"fixed bottom-24 left-6 z-50 w-96 max-w-[90vw] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"p-3 border-b border-slate-100 dark:border-slate-700 font-medium",children:"دستیار قناری"}),(0,a.jsx)("div",{className:"p-3 h-64 overflow-auto",id:"qanari-chat-scroll",ref:i,children:r.map((e,t)=>(0,a.jsx)("div",{className:"mb-3 ".concat("user"===e.role?"text-right":"text-left"),children:(0,a.jsx)("div",{className:"inline-block px-3 py-2 rounded ".concat("user"===e.role?"bg-blue-50 dark:bg-blue-900":"bg-slate-100 dark:bg-slate-700"),children:e.content})},t))}),(0,a.jsxs)("div",{className:"p-3 border-t border-slate-100 dark:border-slate-700 flex gap-2",children:[(0,a.jsx)("input",{ref:u,value:n,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"===e.key&&send()},className:"flex-1 px-3 py-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900",placeholder:"سوالتان را بنویسید..."}),(0,a.jsx)("button",{onClick:send,disabled:d,className:"bg-blue-600 text-white px-3 py-2 rounded",children:d?"در حال ارسال...":"ارسال"})]})]})]})}}}]);