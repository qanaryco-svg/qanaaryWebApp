(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[299],{1140:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/media",function(){return a(9227)}])},3488:function(e,t,a){"use strict";a.d(t,{HZ:function(){return deleteUpload},IT:function(){return loadUploads},TX:function(){return transferUploads},gI:function(){return updateUpload},wW:function(){return addUpload}});let l="qanari:uploads";function loadUploads(e){try{let t=localStorage.getItem(l),a=t?JSON.parse(t):[];if(void 0===e)return a;return a.filter(t=>t.galleryId===e)}catch(e){return[]}}function saveUploads(e){try{localStorage.setItem(l,JSON.stringify(e))}catch(e){}}function addUpload(e){let t=loadUploads();t.unshift(e),saveUploads(t)}function deleteUpload(e){let t=loadUploads().filter(t=>t.id!==e);saveUploads(t)}function updateUpload(e){try{let t=loadUploads(),a=t.findIndex(t=>t.id===e.id);if(-1===a)return!1;let l=t[a];return t[a]={...l,...e},saveUploads(t),!0}catch(e){return!1}}function transferUploads(e,t){try{let a=loadUploads(),l=!1;for(let n of a)n.galleryId===e&&(n.galleryId=t,l=!0);l&&saveUploads(a)}catch(e){}}},9227:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return AdminMedia}});var l=a(5893),n=a(7294),r=a(1163),s=a(1159),d=a(2463),i=a(3488);function MediaLibrary(){let[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(""),s=(0,n.useRef)(null),[d,o]=(0,n.useState)(null),[c,u]=(0,n.useState)(null),reload=()=>t((0,i.IT)());(0,n.useEffect)(()=>{reload()},[]);let onFile=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let l=await new Promise((e,t)=>{let l=new FileReader;l.onload=()=>e(l.result),l.onerror=()=>t(Error("failed to read file")),l.readAsDataURL(a)}),n=/\.(woff2?|ttf|otf)$/i.test(a.name)||a.type.startsWith("font"),r={id:"u_".concat(Date.now()),type:a.type.startsWith("image")?"image":a.type.startsWith("video")?"video":n?"font":"image",name:a.name,dataUrl:l,galleryId:null,createdAt:Date.now()};(0,i.wW)(r),reload(),s.current&&(s.current.value="")},onDelete=e=>{confirm("آیا از حذف مطمئن هستید؟")&&((0,i.HZ)(e),reload())},startEdit=e=>{o(e),u({name:e.name,category:e.category||""})},applyEdit=()=>{d&&((0,i.gI)({id:d.id,name:c.name,...c.category?{category:c.category}:{}}),o(null),u(null),reload())},f=e.filter(e=>!a||e.name.toLowerCase().includes(a.toLowerCase()));return(0,n.useEffect)(()=>{for(let t of e){if("font"!==t.type)continue;let e="font-face-".concat(t.id);if(!document.getElementById(e))try{let a=document.createElement("style");a.id=e;let l="qanari-font-".concat(t.id);a.innerHTML="@font-face { font-family: '".concat(l,"'; src: url('").concat(t.dataUrl,"'); }"),document.head.appendChild(a)}catch(e){}}return()=>{let t=Array.from(document.querySelectorAll('style[id^="font-face-"]'));for(let a of t){let t=a.id,l=e.find(e=>"font-face-".concat(e.id)===t);l||a.remove()}}},[e]),(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,l.jsx)("input",{ref:s,type:"file",accept:"image/*,video/*,.woff,.ttf,.otf",onChange:onFile}),(0,l.jsx)("input",{placeholder:"جستجو",value:a,onChange:e=>r(e.target.value),className:"px-2 py-1 border rounded"})]}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:f.map(e=>(0,l.jsxs)("div",{className:"border p-2 rounded text-right",children:["image"===e.type?(0,l.jsx)("img",{src:e.dataUrl,alt:e.name,className:"h-32 w-full object-contain mb-2"}):"video"===e.type?(0,l.jsx)("video",{src:e.dataUrl,className:"h-32 w-full mb-2",controls:!0}):(0,l.jsx)("div",{className:"h-32 w-full mb-2 flex items-center justify-center bg-gray-50",children:(0,l.jsxs)("div",{style:{fontFamily:"qanari-font-".concat(e.id)},className:"text-center",children:[(0,l.jsx)("div",{className:"text-sm",children:"نمونه فونت"}),(0,l.jsx)("div",{className:"text-xs text-gray-600",children:e.name})]})}),(0,l.jsx)("div",{className:"text-sm font-medium",children:e.name}),(0,l.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,l.jsx)("button",{onClick:()=>startEdit(e),className:"px-2 py-1 border rounded text-sm",children:"ویرایش"}),(0,l.jsx)("button",{onClick:()=>onDelete(e.id),className:"px-2 py-1 border rounded text-sm text-red-600",children:"حذف"})]})]},e.id))}),d&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white p-4 rounded shadow max-w-md w-full text-right",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"ویرایش رسانه"}),(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsx)("label",{className:"block text-sm mb-1",children:"نام"}),(0,l.jsx)("input",{value:(null==c?void 0:c.name)||"",className:"w-full border px-2 py-1",onChange:e=>u({...c,name:e.target.value})})]}),(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsx)("label",{className:"block text-sm mb-1",children:"گروه/دسته"}),(0,l.jsx)("input",{value:(null==c?void 0:c.category)||"",className:"w-full border px-2 py-1",onChange:e=>u({...c,category:e.target.value})})]}),(0,l.jsxs)("div",{className:"flex gap-2 justify-end mt-4",children:[(0,l.jsx)("button",{onClick:()=>o(null),className:"px-3 py-1 border rounded",children:"انصراف"}),(0,l.jsx)("button",{onClick:()=>applyEdit(),className:"px-3 py-1 bg-green-500 text-white rounded",children:"ذخیره"})]})]})})]})}function AdminMedia(){let e=(0,r.useRouter)();return(0,n.useEffect)(()=>{let t="true"===sessionStorage.getItem("qanari:admin");t||e.push("/admin/login")},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.Z,{}),(0,l.jsxs)("main",{className:"container py-8",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"کتابخانه رسانه"}),(0,l.jsx)(MediaLibrary,{})]}),(0,l.jsx)(d.Z,{})]})}}},function(e){e.O(0,[424,607,774,888,179],function(){return e(e.s=1140)}),_N_E=e.O()}]);