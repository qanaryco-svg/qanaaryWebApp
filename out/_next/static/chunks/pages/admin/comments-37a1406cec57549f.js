(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[897],{846:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/comments",function(){return s(9162)}])},2095:function(e,t,s){"use strict";s.r(t),s.d(t,{addComment:function(){return addComment},deleteComment:function(){return deleteComment},deleteCommentsForProduct:function(){return deleteCommentsForProduct},getCommentsFor:function(){return getCommentsFor},getStats:function(){return getStats},loadAllComments:function(){return loadAllComments},persistAllComments:function(){return persistAllComments}});let r="qanari:comments";function loadAllComments(){try{let e=localStorage.getItem(r);return e?JSON.parse(e):[]}catch(e){return[]}}function getCommentsFor(e){return loadAllComments().filter(t=>t.productId===e)}function getStats(e){let t=getCommentsFor(e),s=t.length;if(0===s)return{avg:0,count:0};let r=t.reduce((e,t)=>e+(t.rating||0),0);return{avg:r/s,count:s}}function persistAllComments(e){try{localStorage.setItem(r,JSON.stringify(e));try{window.dispatchEvent(new CustomEvent("qanari:comments-updated"))}catch(e){}try{if("undefined"!=typeof BroadcastChannel){let e=new BroadcastChannel("qanari:comments");e.postMessage({type:"updated"}),e.close()}}catch(e){}}catch(e){}}function addComment(e){let t=loadAllComments(),s=[e,...t];persistAllComments(s)}function deleteComment(e){let t=loadAllComments(),s=t.filter(t=>t.id!==e);persistAllComments(s)}function deleteCommentsForProduct(e){let t=loadAllComments(),s=t.filter(t=>t.productId!==e);persistAllComments(s)}},9162:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return AdminComments}});var r=s(5893),n=s(7294),a=s(8675),l=s(2095),c=s(2929),d=s(3293),o=s(8120),i=s(1163),m=s(1664),u=s.n(m);function AdminComments(){let[e,t]=(0,n.useState)([]),[s,m]=(0,n.useState)([]),[h,p]=(0,n.useState)(new Set),[x,g]=(0,n.useState)(""),[f,C]=(0,n.useState)(0),[j,N]=(0,n.useState)(""),[y,v]=(0,n.useState)("date"),[b,S]=(0,n.useState)("desc"),{lang:w}=(0,d.Z)(),A=(0,i.useRouter)();(0,n.useEffect)(()=>{let e="true"===sessionStorage.getItem("qanari:admin");e||A.push("/admin/login");let s=(0,c.QD)();m(s);let r=(0,l.loadAllComments)().map(e=>({...e,product:s.find(t=>t.id===e.productId)}));t(r)},[]);let k=e.filter(e=>{if(x&&e.productId!==x||f>0&&e.rating!==f)return!1;if(j){let t=j.toLowerCase(),s=e.product?(0,o.pC)(e.product,w).title.toLowerCase():"";return e.name.toLowerCase().includes(t)||e.text.toLowerCase().includes(t)||s.includes(t)}return!0}).sort((e,t)=>"date"===y?"desc"===b?t.createdAt-e.createdAt:e.createdAt-t.createdAt:"rating"===y?"desc"===b?t.rating-e.rating:e.rating-t.rating:"desc"===b?t.name.localeCompare(e.name):e.name.localeCompare(t.name)),toggleSort=e=>{y===e?S("desc"===b?"asc":"desc"):(v(e),S("desc"))},handleDeleteSelected=async()=>{if(!h.size||!confirm("آیا از حذف "+h.size+" نظر انتخاب شده مطمئن هستید؟"))return;let s=e.filter(e=>!h.has(e.id));(0,l.persistAllComments)(s),t(s),p(new Set)},handleSelectAll=e=>{e?p(new Set(k.map(e=>e.id))):p(new Set)};return(0,r.jsx)(a.Z,{children:(0,r.jsxs)("div",{className:"container py-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"مدیریت نظرات"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>{if(confirm("آیا می‌خواهید نمونه‌های پیش‌فرض را بازگردانید؟"))try{localStorage.removeItem("qanari:comments-seeded"),localStorage.removeItem("qanari:comments"),A.reload()}catch(e){}},className:"px-3 py-2 border rounded hover:bg-gray-50",children:"بازگرداندن نمونه‌ها"}),(0,r.jsx)("button",{onClick:()=>{if(confirm("آیا از حذف تمام نظرات مطمئن هستید؟ این عمل برگشت‌پذیر نیست."))try{(0,l.persistAllComments)([]);try{localStorage.setItem("qanari:comments-seeded","true")}catch(e){}t([]),p(new Set)}catch(e){}},className:"px-3 py-2 border rounded text-red-600 hover:bg-red-50",children:"حذف همه نظرات"})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow mb-6",children:[(0,r.jsx)("div",{className:"p-4 border-b",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,r.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,r.jsx)("input",{type:"text",placeholder:"جستجو در نام، متن نظر یا محصول...",className:"w-full px-3 py-2 border rounded",value:j,onChange:e=>N(e.target.value)})}),(0,r.jsx)("div",{children:(0,r.jsxs)("select",{className:"px-3 py-2 border rounded",value:x,onChange:e=>g(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"همه محصولات"}),s.map(e=>(0,r.jsx)("option",{value:e.id,children:(0,o.pC)(e,w).title},e.id))]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("select",{className:"px-3 py-2 border rounded",value:f,onChange:e=>C(Number(e.target.value)),children:[(0,r.jsx)("option",{value:"0",children:"همه امتیازها"}),[5,4,3,2,1].map(e=>(0,r.jsxs)("option",{value:e,children:[e," ستاره"]},e))]})})]})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:(0,r.jsx)("input",{type:"checkbox",checked:h.size>0&&h.size===k.length,onChange:e=>handleSelectAll(e.target.checked)})}),(0,r.jsxs)("th",{className:"px-4 py-3 text-right cursor-pointer hover:bg-gray-100",onClick:()=>toggleSort("name"),children:["نام کاربر","name"===y&&(0,r.jsx)("span",{className:"mr-1",children:"desc"===b?"▼":"▲"})]}),(0,r.jsxs)("th",{className:"px-4 py-3 text-right cursor-pointer hover:bg-gray-100",onClick:()=>toggleSort("rating"),children:["امتیاز","rating"===y&&(0,r.jsx)("span",{className:"mr-1",children:"desc"===b?"▼":"▲"})]}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"متن نظر"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"محصول"}),(0,r.jsxs)("th",{className:"px-4 py-3 text-right cursor-pointer hover:bg-gray-100",onClick:()=>toggleSort("date"),children:["تاریخ","date"===y&&(0,r.jsx)("span",{className:"mr-1",children:"desc"===b?"▼":"▲"})]}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"عملیات"})]})}),(0,r.jsxs)("tbody",{className:"divide-y",children:[k.map(s=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("input",{type:"checkbox",checked:h.has(s.id),onChange:e=>{let t=new Set(h);e.target.checked?t.add(s.id):t.delete(s.id),p(t)}})}),(0,r.jsx)("td",{className:"px-4 py-3",children:s.name}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("div",{className:"text-yellow-500",children:"★".repeat(s.rating)+"☆".repeat(5-s.rating)})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("div",{className:"max-w-md truncate",children:s.text})}),(0,r.jsx)("td",{className:"px-4 py-3",children:s.product?(0,r.jsx)(u(),{href:"/products/"+s.productId,target:"_blank",className:"text-blue-600 hover:underline",children:(0,o.pC)(s.product,w).title}):s.productId}),(0,r.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(s.createdAt).toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("button",{onClick:()=>{confirm("آیا از حذف این نظر مطمئن هستید؟")&&((0,l.deleteComment)(s.id),t(e.filter(e=>e.id!==s.id)))},className:"text-red-600 hover:text-red-800",children:"حذف"})})]},s.id)),0===k.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:0===e.length?"هیچ نظری ثبت نشده است.":"نظری با این فیلترها یافت نشد."})})]})]})}),h.size>0&&(0,r.jsx)("div",{className:"p-4 border-t bg-gray-50",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[h.size," نظر انتخاب شده"]}),(0,r.jsx)("button",{onClick:handleDeleteSelected,className:"px-3 py-1 text-sm text-red-600 border border-red-600 rounded hover:bg-red-50",children:"حذف موارد انتخاب شده"})]})})]})]})})}}},function(e){e.O(0,[424,675,774,888,179],function(){return e(e.s=846)}),_N_E=e.O()}]);