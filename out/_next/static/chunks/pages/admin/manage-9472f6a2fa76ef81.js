(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{7361:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/manage",function(){return t(4674)}])},4674:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return AdminManage}});var l=t(5893),a=t(7294),d=t(8675),r=t(2929),c=t(2095),i=t(3064),n=t(8120),o=t(1163),x=t(3293);function AdminManage(){let[e,s]=(0,a.useState)([]),[t,h]=(0,a.useState)(null),[m,p]=(0,a.useState)("products"),[g,u]=(0,a.useState)([]),j=(0,o.useRouter)(),{lang:v}=(0,x.Z)();(0,a.useEffect)(()=>{let e="true"===sessionStorage.getItem("qanari:admin");e||j.push("/admin/login"),s((0,r.QD)()),u((0,c.loadAllComments)())},[]);let onAdd=e=>{(0,r.gK)(e),s((0,r.QD)()),h(null)},onUpdate=e=>{(0,r.nM)(e),s((0,r.QD)()),h(null)},onDelete=e=>{if(confirm("آیا مطمئن هستید؟")){(0,r.Ir)(e),s((0,r.QD)());try{window.dispatchEvent(new CustomEvent("qanari:products-updated"))}catch(e){}try{if("undefined"!=typeof BroadcastChannel){let s=new BroadcastChannel("qanari:products");s.postMessage({type:"deleted",id:e}),s.close()}}catch(e){}}},[N,w]=(0,a.useState)("date"),[b,y]=(0,a.useState)("desc"),[f,C]=(0,a.useState)(""),[S,k]=(0,a.useState)(new Set),[z,M]=(0,a.useState)("all"),A=(0,a.useMemo)(()=>({totalProducts:e.length,totalValue:e.reduce((e,s)=>e+s.price,0),categories:e.reduce((e,s)=>(e[s.category]=(e[s.category]||0)+1,e),{}),totalComments:g.length,averageRating:g.length?g.reduce((e,s)=>e+(Number(s.rating)||0),0)/g.length:0}),[e,g]),_=(0,a.useMemo)(()=>{let s=[...e];if(f){let e=f.toLowerCase();s=s.filter(s=>(0,n.pC)(s,v).title.toLowerCase().includes(e)||(0,n.pC)(s,v).description.toLowerCase().includes(e)||s.id.toLowerCase().includes(e))}return"all"!==z&&(s=s.filter(e=>e.category===z)),s.sort((e,s)=>{let t=0;return"title"===N?t=(0,n.pC)(e,v).title.localeCompare((0,n.pC)(s,v).title):"price"===N&&(t=e.price-s.price),"asc"===b?t:-t}),s},[e,f,z,N,b,v]),toggleSort=e=>{N===e?y("asc"===b?"desc":"asc"):(w(e),y("desc"))},handleSelectAll=e=>{e?k(new Set(_.map(e=>e.id))):k(new Set)};return(0,l.jsx)(d.Z,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"کل محصولات"}),(0,l.jsx)("div",{className:"text-2xl font-bold mt-1",children:A.totalProducts})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"ارزش کل موجودی"}),(0,l.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[A.totalValue.toLocaleString()," تومان"]})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"تعداد نظرات"}),(0,l.jsx)("div",{className:"text-2xl font-bold mt-1",children:A.totalComments})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"میانگین امتیاز"}),(0,l.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[A.averageRating.toFixed(1),(0,l.jsx)("span",{className:"text-yellow-500 mr-1",children:"★"})]})]})]}),t?(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,l.jsx)("div",{className:"p-6 border-b",children:(0,l.jsx)("h2",{className:"text-xl font-bold",children:t.id?"ویرایش محصول":"افزودن محصول جدید"})}),(0,l.jsx)("div",{className:"p-6",children:(0,l.jsx)(i.Z,{product:t,onCancel:()=>h(null),onSave:e=>t.id?onUpdate(e):onAdd(e)})})]}):"products"===m?(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,l.jsx)("div",{className:"p-6 border-b",children:(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,l.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,l.jsx)("input",{type:"text",value:f,onChange:e=>C(e.target.value),placeholder:"جستجو در محصولات...",className:"w-full px-4 py-2 border rounded-lg"})}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,l.jsxs)("select",{value:z,onChange:e=>M(e.target.value),className:"px-4 py-2 border rounded-lg",children:[(0,l.jsx)("option",{value:"all",children:"همه دسته‌ها"}),Object.entries(A.categories).map(e=>{let[s,t]=e;return(0,l.jsxs)("option",{value:s,children:[s," (",t,")"]},s)})]}),(0,l.jsx)("button",{onClick:()=>h({id:"",title:"",price:0,images:[""],description:"",category:""}),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"افزودن محصول"}),S.size>0&&(0,l.jsxs)("button",{onClick:()=>{S.size&&confirm("آیا از حذف ".concat(S.size," محصول انتخاب شده مطمئن هستید؟"))&&(S.forEach(e=>onDelete(e)),k(new Set))},className:"px-4 py-2 border border-red-500 text-red-600 rounded-lg hover:bg-red-50",children:["حذف ",S.size," محصول"]})]})]})}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-6 py-3 text-right",children:(0,l.jsx)("input",{type:"checkbox",checked:S.size>0&&S.size===_.length,onChange:e=>handleSelectAll(e.target.checked),className:"rounded border-gray-300"})}),(0,l.jsx)("th",{className:"px-6 py-3 text-right",children:"تصویر"}),(0,l.jsxs)("th",{className:"px-6 py-3 text-right cursor-pointer hover:bg-gray-100",onClick:()=>toggleSort("title"),children:["عنوان","title"===N&&(0,l.jsx)("span",{className:"mr-1",children:"desc"===b?"▼":"▲"})]}),(0,l.jsxs)("th",{className:"px-6 py-3 text-right cursor-pointer hover:bg-gray-100",onClick:()=>toggleSort("price"),children:["قیمت","price"===N&&(0,l.jsx)("span",{className:"mr-1",children:"desc"===b?"▼":"▲"})]}),(0,l.jsx)("th",{className:"px-6 py-3 text-right",children:"دسته"}),(0,l.jsx)("th",{className:"px-6 py-3 text-right",children:"عملیات"})]})}),(0,l.jsxs)("tbody",{className:"divide-y",children:[_.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsx)("input",{type:"checkbox",checked:S.has(e.id),onChange:s=>{let t=new Set(S);s.target.checked?t.add(e.id):t.delete(e.id),k(t)},className:"rounded border-gray-300"})}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsx)("img",{src:e.images[0]||"/logo.png",alt:(0,n.pC)(e,v).title,className:"w-16 h-16 object-cover rounded-lg"})}),(0,l.jsxs)("td",{className:"px-6 py-4",children:[(0,l.jsx)("div",{className:"font-medium",children:(0,n.pC)(e,v).title}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:e.id})]}),(0,l.jsxs)("td",{className:"px-6 py-4 font-medium",children:[e.price.toLocaleString()," تومان"]}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded-full text-sm",children:e.category})}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:()=>h(e),className:"text-blue-600 hover:text-blue-800",title:"ویرایش محصول",children:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,l.jsx)("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),(0,l.jsx)("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z",clipRule:"evenodd"})]})}),(0,l.jsx)("button",{onClick:()=>onDelete(e.id),className:"text-red-600 hover:text-red-800",title:"حذف محصول",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})})]},e.id)),0===_.length&&(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"هیچ محصولی با این فیلترها پیدا نشد."})})]})]})})]}):(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,l.jsx)("div",{className:"p-6 border-b",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-xl font-bold",children:"مدیریت نظرات"}),(0,l.jsx)("button",{onClick:()=>{if(confirm("آیا از حذف تمام نظرات مطمئن هستید؟ این عمل برگشت‌پذیر نیست."))try{(0,c.persistAllComments)([]);try{localStorage.setItem("qanari:comments-seeded","true")}catch(e){}u([])}catch(e){}},className:"px-4 py-2 border border-red-500 text-red-600 rounded-lg hover:bg-red-50",children:"حذف همه نظرات"})]})}),(0,l.jsx)("div",{className:"p-6",children:(0,l.jsxs)("div",{className:"space-y-4",children:[0===g.length&&(0,l.jsx)("div",{className:"text-center text-gray-500 py-8",children:"هیچ نظری ثبت نشده است."}),g.map(s=>(0,l.jsx)("div",{className:"p-4 border rounded-lg hover:bg-gray-50",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"font-semibold",children:s.name}),(0,l.jsx)("div",{className:"text-sm text-yellow-500",children:"★".repeat(Math.max(0,Number(s.rating)||0))+"☆".repeat(Math.max(0,5-(Number(s.rating)||0)))}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:new Date(s.createdAt).toLocaleString()})]}),(0,l.jsx)("div",{className:"mt-2",children:s.text}),(0,l.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["محصول:"," ",(()=>{let t=e.find(e=>e.id===s.productId);return t?(0,l.jsx)("span",{className:"text-blue-600",children:(0,n.pC)(t,v).title}):(0,l.jsx)("span",{className:"text-red-600",children:s.productId})})()]})]}),(0,l.jsx)("button",{onClick:()=>{confirm("آیا از حذف این نظر مطمئن هستید؟")&&((0,c.deleteComment)(s.id),u((0,c.loadAllComments)()))},className:"text-red-600 hover:text-red-800",title:"حذف نظر",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})},s.id))]})})]})]})})}}},function(e){e.O(0,[424,675,177,774,888,179],function(){return e(e.s=7361)}),_N_E=e.O()}]);