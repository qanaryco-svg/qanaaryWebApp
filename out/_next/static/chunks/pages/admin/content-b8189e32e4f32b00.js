(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{3705:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/content",function(){return s(9265)}])},9265:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return AdminContentPage}});var a=s(5893),l=s(7294),n=s(8675),d=s(2929),c=s(8120),i=s(3064),r=s(1163);function AdminContentPage(){let[e,t]=(0,l.useState)([]),[o,x]=(0,l.useState)(null),[h,u]=(0,l.useState)({}),[m,p]=(0,l.useState)("همه"),[j,g]=(0,l.useState)(""),[N,y]=(0,l.useState)("all"),[b,f]=(0,l.useState)(new Set),[v,w]=(0,l.useState)(1),C=(0,r.useRouter)(),k=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e="true"===sessionStorage.getItem("qanari:admin");e||C.push("/admin/login"),t((0,d.QD)())},[]),(0,l.useEffect)(()=>{if(o)try{let e=k.current;e&&"function"==typeof e.scrollIntoView&&e.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{try{let t=null==e?void 0:e.querySelector("input, textarea, select");null==t||t.focus()}catch(e){}},300)}catch(e){}},[o]),(0,l.useEffect)(()=>{try{let{getStats:t}=s(2095),a={};e.forEach(e=>{a[e.id]=t(e.id)}),u(a)}catch(e){u({})}},[e]);let{t:S,lang:_}=(()=>{try{let e=s(3293).Z();return e}catch(e){return{t:e=>e,lang:"fa"}}})(),E=(0,l.useMemo)(()=>Array.from(new Set(["همه",...e.map(e=>(0,c.pC)(e,_).category)])),[e,_]),D=(0,l.useMemo)(()=>{let t=[...e];if(j){let e=j.toLowerCase();t=t.filter(t=>(0,c.pC)(t,_).title.toLowerCase().includes(e)||(0,c.pC)(t,_).description.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))}return"همه"!==m&&(t=t.filter(e=>(0,c.pC)(e,_).category===m)),t},[e,j,m,N,_]),M=Math.max(1,Math.ceil(D.length/12)),Q=D.slice((v-1)*12,12*v),onAdd=e=>{(0,d.gK)(e),t((0,d.QD)()),x(null)},onUpdate=e=>{(0,d.nM)(e),t((0,d.QD)()),x(null)},onDelete=e=>{if(confirm("آیا مطمئن هستید؟")){(0,d.Ir)(e),t((0,d.QD)());try{window.dispatchEvent(new CustomEvent("qanari:products-updated"))}catch(e){}try{if("undefined"!=typeof BroadcastChannel){let t=new BroadcastChannel("qanari:products");t.postMessage({type:"deleted",id:e}),t.close()}}catch(e){}}};return(0,a.jsx)(n.Z,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"پنل محتوا"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{value:j,onChange:e=>{g(e.target.value),w(1)},placeholder:"جستجو عنوان، متن یا شناسه",className:"px-3 py-2 border rounded w-60"}),(0,a.jsx)("select",{value:m,onChange:e=>{p(e.target.value),w(1)},className:"px-3 py-2 border rounded",children:E.map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:()=>x({id:"",title:"",price:0,images:[""],description:"",category:""}),children:"افزودن مطلب"}),(0,a.jsx)("button",{className:"px-3 py-2 border rounded",onClick:()=>{confirm("بازنشانی محصولات به حالت اولیه انجام شود؟")&&((0,d.GC)(),t((0,d.QD)()))},children:"بازنشانی"}),(0,a.jsx)("button",{className:"px-3 py-2 border rounded",onClick:()=>{sessionStorage.removeItem("qanari:admin"),C.push("/")},children:"خروج"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"کل محصولات"}),(0,a.jsx)("div",{className:"text-2xl font-bold mt-1",children:e.length})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"محصولات نمایش داده شده"}),(0,a.jsx)("div",{className:"text-2xl font-bold mt-1",children:D.length})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"نظرات (کل)"}),(0,a.jsx)("div",{className:"text-2xl font-bold mt-1",children:Object.values(h).reduce((e,t)=>e+(t.count||0),0)})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"میانگین امتیاز"}),(0,a.jsx)("div",{className:"text-2xl font-bold mt-1",children:(Object.values(h).reduce((e,t)=>e+(t.avg||0),0)/(Object.values(h).length||1)).toFixed(1)})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded shadow",children:[(0,a.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"text-sm text-gray-600",children:"وضعیت:"}),(0,a.jsxs)("select",{value:N,onChange:e=>y(e.target.value),className:"px-2 py-1 border rounded",children:[(0,a.jsx)("option",{value:"all",children:"همه"}),(0,a.jsx)("option",{value:"published",children:"منتشر شده"}),(0,a.jsx)("option",{value:"draft",children:"پیش‌نویس"}),(0,a.jsx)("option",{value:"pending",children:"در انتظار"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:b.size>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{className:"px-3 py-2 border rounded text-red-600",onClick:()=>{confirm("آیا از حذف ".concat(b.size," مورد اطمینان دارید؟"))&&(b.forEach(e=>{try{(0,d.Ir)(e)}catch(e){}}),f(new Set),t((0,d.QD)()))},children:["حذف ",b.size]}),(0,a.jsx)("button",{className:"px-3 py-2 border rounded",onClick:()=>{f(new Set)},children:"لغو انتخاب"})]})})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:(0,a.jsx)("input",{type:"checkbox",checked:b.size>0&&b.size===D.length,onChange:e=>{e.target.checked?f(new Set(D.map(e=>e.id))):f(new Set)}})}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"تصویر"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"عنوان"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"قیمت"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"دسته"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"نظرات"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"عملیات"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[Q.map(e=>{var s,l;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("input",{type:"checkbox",checked:b.has(e.id),onChange:t=>{let s=new Set(b);t.target.checked?s.add(e.id):s.delete(e.id),f(s)}})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("img",{src:(null===(s=e.images)||void 0===s?void 0:s[0])||"/logo.png",className:"w-16 h-16 object-cover rounded"})}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("div",{className:"font-medium",children:(0,c.pC)(e,_).title}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.id})]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[e.price.toLocaleString()," تومان"]}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,c.pC)(e,_).category}),(0,a.jsx)("td",{className:"px-4 py-3",children:(null===(l=h[e.id])||void 0===l?void 0:l.count)||0}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("a",{href:"/products/".concat(e.id),target:"_blank",rel:"noreferrer",className:"text-blue-600",children:"نمایش"}),(0,a.jsx)("button",{onClick:()=>x(e),className:"text-green-600",children:"ویرایش"}),(0,a.jsx)("button",{onClick:()=>{confirm("آیا حذف شود؟")&&(onDelete(e.id),t((0,d.QD)()))},className:"text-red-600",children:"حذف"})]})})]},e.id)}),0===Q.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"موردی یافت نشد."})})]})]})}),(0,a.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["نمایش ",(v-1)*12+1," - ",Math.min(12*v,D.length)," از ",D.length]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{disabled:v<=1,onClick:()=>w(e=>Math.max(1,e-1)),className:"px-3 py-1 border rounded disabled:opacity-50",children:"قبلی"}),(0,a.jsxs)("div",{className:"px-3 py-1 border rounded",children:[v," / ",M]}),(0,a.jsx)("button",{disabled:v>=M,onClick:()=>w(e=>Math.min(M,e+1)),className:"px-3 py-1 border rounded disabled:opacity-50",children:"بعدی"})]})]})]}),o&&(0,a.jsxs)("div",{ref:k,className:"bg-white rounded shadow p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",children:o.id?"ویرایش محصول":"افزودن محصول"}),(0,a.jsx)(i.Z,{product:o,onCancel:()=>x(null),onSave:e=>{o&&o.id?onUpdate(e):onAdd(e),t((0,d.QD)())}})]})]})})}}},function(e){e.O(0,[424,675,177,774,888,179],function(){return e(e.s=3705)}),_N_E=e.O()}]);